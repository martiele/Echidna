{% extends "base/template.twig" %}

{% block content %}
    <main style="padding-top: 130px;">
        <div class="container">
            <div class="row">
                <div class="col-6">

                </div>
                <div class="col-6">
                    <h2>{{ prodotto.nome }}</h2>
                    <p>{{ prodotto.descrizione }}</p>

                    {% if prodotto.varianti|length > 1 %}
                        {% for variante in prodotto.varianti %}
                            <form class="variante"
                                    {% for attributo in variante.attributi %}

                                    data-attribute{{ attributo.attributo.id }}="{{ attributo.valore.id }}"

                                    {% endfor %}>
                                    <input type="hidden" name="id_variante" value="{{ variante.id }}">
                            </form>


                        {% endfor  %}


                       {# <form class="scelta-attributi">
                        {% for attributo in attributi %}
                            <select name="{{ attributo.attributo.id }}">

                                <option value="">...scegli</option>

                                 {% for valore in attributo.valori %}

                                    <option>{{ valore.valore }}</option>
                                {% endfor %}

                            </select>
                        {% endfor %}
                        </form>
                        #}

                        <form class="scelta-attributi">
                            {% for attributo in attributi %}
                                <label>{{ attributo.attributo.nome }}</label>
                                <select name="{{ attributo.attributo.id }}" class="form-control">

                                    <option value="">...scegli</option>

                                    {% for valore in attributo.valori %}

                                        <option value="{{ valore.valore.id }}" {% if valore.attributoprecedentevalore %}
                                            data-idprec="{{ valore.attributoprecedenteid }}" data-valueprec="{{ valore.attributoprecedentevalore }}"
                                        {% endif %}>{{ valore.valore.valore }}</option>
                                    {% endfor %}

                                </select>
                            {% endfor %}
                        </form>


                    {% else %}
                        {% set variante = prodotto.varianti[0] %}
                        <form class="variante">
                            <div class="prezzo">
                                {{ variante.prezzo }}
                            </div>
                        </form>
                    {% endif %}

                </div>
            </div>
        </div>
    </main>
{% endblock %}


{% block javascript_footer %}

    {{ parent() }}
    <script>
    (function( $ ){

        $('.scelta-attributi [data-idprec]').hide();

        $(document).on("change","form.scelta-attributi",function () {

            console.log( $(this).serializeArray());

            selettore = [];
            selettoreVariante = [];

            variante = null;
            $('.scelta-attributi [data-idprec]').hide();

            $(this).serializeArray().forEach(function( o ){
                selettoreVariante.push('[data-attribute' + o.name +'="'+ o.value +'"]' );

                if(o.value !="") {

                    selettore.push('[data-idprec="' + o.name + '"][data-valueprec="' + o.value + '"]');

                }

            });
            $('.scelta-attributi '+selettore.join()).show();

            console.log( $(selettoreVariante.join("")).first().find('[name="id_variante"]').val() );




        })
    })(jQuery);
    </script>
{% endblock %}