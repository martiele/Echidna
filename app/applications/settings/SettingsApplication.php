<?php

namespace applications\settings;

use applications\settings\entities\CustomTemplate;
use applications\settings\entities\Setting;
use backend\Menu;
use core\abstracts\Application;
use core\abstracts\BackendApplication;
use core\abstracts\FrontendApplication;
use core\Model;
use core\services\Response;
use core\services\RouterService;

class SettingsApplication extends Application{
    static function getFrontendApplication()
    {
        return null;
    }

    static function getBackendApplication()
    {
        return SettingsBackend::class;
    }

    static function getEntityClass()
    {
        return Setting::class;
    }


    static function init($n)
    {
        parent::init($n); // TODO: Change the autogenerated stub

        /*Response::addVariable([
            "menu"  =>  [
                "gestionecontenuti" => [[
                    "label" =>  "Banner",
                    "children"  =>  [
                        ["label" => "Lista", "href" =>  "/backend/banner/lista"],
                        ["label" => "Aggiungi","href" =>  "/backend/banner/aggiungi"]
                    ]
                ]]
            ]
        ]);*/

        RouterService::addRoutesPrefixed(CustomTemplateBackend::declareRoutes(),"/backend/settings/custom-templates");

        
        $template = Response::getBackendTemplate();
        $template->addFunction("setting_value",function ($key){
            return Setting::getValueOf($key);
        });

        $menu = new Menu("Settings",self::getBackendApplication()::getIcon());

        $menu->addItem("Impostazioni cache",RouterService::getRoute("backend.settings.cache"));
        $menu->addItem("Valori personalizzati",RouterService::getRoute(Setting::getEntity().".list"));
        $menu->addItem("Template personalizzati",RouterService::getRoute(CustomTemplate::getEntity().".list"));

        $menu->addItem("Applicazioni",RouterService::getRoute("backend.settings.applications"));

        $backend = Response::getBackendTemplate();
        $backend::addMenu($menu);

   
    }

    static function install()
    {
        return [
            CustomTemplate::class
        ];
    }

}